<!DOCTYPE html><html lang="en"><head>  <meta charset="UTF-8" />  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>  <title>Dashboard | Ally Bank</title>  <link rel="stylesheet" href="styles.css" />  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"></head><body class="dashboard-page">  <!-- Navigation -->  <nav class="navbar">    <div class="container nav-container">      <div class="logo">        <h2>Ally<span>Bank</span></h2>      </div>      <ul class="nav-links" id="navLinks">        <li><a href="index.html">Home</a></li>        <li><a href="accounts.html">Accounts</a></li>        <li><a href="savings.html">Savings</a></li>        <li><a href="investing.html">Investing</a></li>        <li><a href="support.html">Support</a></li>        <li><a href="#" id="logoutBtn" class="btn-login">Logout</a></li>      </ul>      <div class="mobile-menu-toggle">Menu</div>    </div>  </nav>  <!-- Dynamic Greeting Header -->  <header class="dashboard-header">    <div class="container">      <div class="greeting-container">        <h1 id="dynamicGreeting">Welcome, <span id="userName"></span>!</h1>        <p class="subtitle" id="greetingSubtitle">Your account is secure and ready.</p>      </div>      <p class="account-info">Account: <strong id="userAccNum"></strong></p>    </div>  </header>  <!-- First-Time User Banner -->  <div id="firstTimeBanner" class="banner info" style="display:none;">    <div class="container">      <div class="banner-content">        <span class="icon">Lock</span>        <div>          <strong>Secure your account</strong><br>          <small>Set your 4-digit PIN to enable transfers and payments.</small>        </div>        <button class="btn-primary small" onclick="openSetPinModal()">Set PIN</button>      </div>    </div>  </div>  <!-- Dashboard Content -->  <section class="dashboard-content">    <div class="container">      <!-- SHOW PROFILE BUTTON -->      <div style="text-align:center; margin: 1.5rem 0;">        <button class="show-profile-btn" onclick="toggleProfile()">Show Profile</button>      </div>      <div class="dashboard-grid">        <!-- USER PROFILE CARD (HIDDEN BY DEFAULT) -->        <div class="card profile-card">          <div class="card-header">            <h3>User Profile</h3>            <button class="btn-icon" onclick="openEditProfile()">Edit</button>          </div>          <div class="card-body">            <div class="profile-avatar">              <div class="avatar-circle">                <span id="profileInitials"></span>              </div>            </div>            <div class="profile-details">              <p><strong>Full Name:</strong> <span id="profileName"></span></p>              <p><strong>Email:</strong> <span id="profileEmail"></span></p>              <p><strong>Phone:</strong> <span id="profilePhone"></span></p>              <p><strong>Address:</strong> <span id="profileAddress"></span></p>              <p><strong>Date of Birth:</strong> <span id="profileDOB"></span></p>              <p><strong>Account Created:</strong> <span id="profileCreated"></span></p>            </div>          </div>        </div>        <!-- Balance Card -->        <div class="card balance-card">          <div class="card-header">            <h3>Available Balance</h3>            <span class="badge success">Active</span>          </div>          <div class="card-body">            <p class="balance-amount">$<span id="userBalance">0.00</span></p>            <button class="btn-primary" onclick="openTransferModal()">Transfer Money</button>          </div>        </div>        <!-- Quick Actions -->        <div class="card quick-actions">          <div class="card-header">            <h3>Quick Actions</h3>          </div>          <div class="card-body">            <div class="action-grid">              <button class="action-btn" onclick="openPayBillModal()">Pay Bills</button>              <button class="action-btn" onclick="openDepositModal()">Mobile Deposit</button>              <button class="action-btn" onclick="openSendMoneyModal()">Send Money</button>            </div>          </div>        </div>        <!-- Recent Transactions -->        <div class="card transactions-card">          <div class="card-header">            <h3>Recent Transactions</h3>            <a href="#" class="link-sm" onclick="openFullHistory()">View All</a>          </div>          <div class="card-body">            <div id="transactionsList" class="transactions-list">              <p class="no-data">No recent transactions.</p>            </div>          </div>        </div>      </div>    </div>  </section>  <!-- Set PIN Modal -->  <div id="setPinModal" class="modal">    <div class="modal-content">      <div class="modal-header">        <h2>Set Your PIN</h2>        <span class="close" onclick="closeModal()">x</span>      </div>      <div class="modal-body">        <form id="setPinForm">          <div class="input-group">            <label>4-Digit PIN</label>            <input type="password" id="newPin" maxlength="4" placeholder="••••" required />          </div>          <div class="input-group">            <label>Confirm PIN</label>            <input type="password" id="confirmPin" maxlength="4" placeholder="••••" required />          </div>          <button type="submit" class="btn-primary full">Set PIN</button>        </form>      </div>    </div>  </div>  <!-- Edit Profile Modal -->  <div id="editProfileModal" class="modal">    <div class="modal-content">      <div class="modal-header">        <h2>Edit Profile</h2>        <span class="close" onclick="closeModal()">x</span>      </div>      <div class="modal-body">        <form id="editProfileForm">          <div class="input-group">            <label>Full Name</label>            <input type="text" id="editName" required />          </div>          <div class="input-group">            <label>Email</label>            <input type="email" id="editEmail" required />          </div>          <div class="input-group">            <label>Phone</label>            <input type="tel" id="editPhone" placeholder="123-456-7890" required />          </div>          <div class="input-group">            <label>Address</label>            <input type="text" id="editAddress" required />          </div>          <div class="input-group">            <label>Date of Birth</label>            <input type="date" id="editDOB" required />          </div>          <button type="submit" class="btn-primary full">Save Changes</button>        </form>      </div>    </div>  </div>  <!-- Transfer Modal -->  <div id="transferModal" class="modal">    <div class="modal-content">      <div class="modal-header">        <h2>Transfer Money</h2>        <span class="close" onclick="closeModal()">x</span>      </div>      <div class="modal-body">        <form id="transferForm">          <div class="input-group">            <label>Amount</label>            <input type="number" id="transferAmount" placeholder="0.00" step="0.01" min="0.01" required />          </div>          <div class="input-group">            <label>Recipient Account Number</label>            <input type="text" id="transferAccNum" placeholder="1234567890" maxlength="10" required />            <small style="color:#666; font-size:0.8em;">Exactly 10 digits</small>          </div>          <div class="input-group">            <label>Recipient Full Name</label>            <input type="text" id="transferName" placeholder="John Doe" required />          </div>          <div class="input-group">            <label>4-Digit PIN</label>            <input type="password" id="transferPin" maxlength="4" placeholder="••••" required />          </div>          <button type="submit" class="btn-primary full">Send Transfer</button>        </form>      </div>    </div>  </div>  <!-- Confirmation Modal -->  <div id="confirmModal" class="modal">    <div class="modal-content small">      <div class="modal-header">        <h2>Confirm Transfer</h2>        <span class="close" onclick="closeModal()">x</span>      </div>      <div class="modal-body">        <p><strong>To:</strong> <span id="confirmName"></span></p>        <p><strong>Account:</strong> <span id="confirmAcc"></span></p>        <p><strong>Amount:</strong> $<span id="confirmAmount"></span></p>        <div class="btn-group">          <button id="confirmBtn" class="btn-primary">Confirm</button>          <button id="cancelBtn" class="btn-secondary">Cancel</button>        </div>      </div>    </div>  </div>  <!-- Pay Bill Modal -->  <div id="payBillModal" class="modal">    <div class="modal-content">      <div class="modal-header">        <h2>Pay Bill</h2>        <span class="close" onclick="closeModal()">x</span>      </div>      <div class="modal-body">        <form id="payBillForm">          <div class="input-group">            <label>Payee</label>            <input type="text" id="billPayee" placeholder="Electric Company" required />          </div>          <div class="input-group">            <label>Amount</label>            <input type="number" id="billAmount" placeholder="0.00" step="0.01" min="0.01" required />          </div>          <div class="input-group">            <label>4-Digit PIN</label>            <input type="password" id="billPin" maxlength="4" placeholder="••••" required />          </div>          <button type="submit" class="btn-primary full">Pay Now</button>        </form>      </div>    </div>  </div>  <!-- Mobile Deposit Modal -->  <div id="depositModal" class="modal">    <div class="modal-content">      <div class="modal-header">        <h2>Mobile Deposit</h2>        <span class="close" onclick="closeModal()">x</span>      </div>      <div class="modal-body">        <form id="depositForm">          <div class="input-group">            <label>Check Amount</label>            <input type="number" id="depositAmount" placeholder="0.00" step="0.01" min="0.01" required />          </div>          <div class="input-group">            <label>4-Digit PIN</label>            <input type="password" id="depositPin" maxlength="4" placeholder="••••" required />          </div>          <button type="submit" class="btn-primary full">Deposit Check</button>        </form>      </div>    </div>  </div>  <!-- Send Money Modal -->  <div id="sendMoneyModal" class="modal">    <div class="modal-content">      <div class="modal-header">        <h2>Send Money</h2>        <span class="close" onclick="closeModal()">x</span>      </div>      <div class="modal-body">        <form id="sendMoneyForm">          <div class="input-group">            <label>Recipient Email</label>            <input type="email" id="sendEmail" placeholder="friend@example.com" required />          </div>          <div class="input-group">            <label>Amount</label>            <input type="number" id="sendAmount" placeholder="0.00" step="0.01" min="0.01" required />          </div>          <div class="input-group">            <label>4-Digit PIN</label>            <input type="password" id="sendPin" maxlength="4" placeholder="••••" required />          </div>          <button type="submit" class="btn-primary full">Send</button>        </form>      </div>    </div>  </div>  <!-- FULL TRANSACTION HISTORY MODAL -->  <div id="fullHistoryModal" class="modal">    <div class="modal-content large">      <div class="modal-header">        <h2>Full Transaction History</h2>        <span class="close" onclick="closeModal()">x</span>      </div>      <div class="modal-body">        <div id="fullTransactionsList" class="transactions-list full">          <p class="no-data">No transactions yet.</p>        </div>        <div style="margin-top:1.5rem; text-align:center;">          <button class="btn-secondary" onclick="closeModal()">Back to Dashboard</button>        </div>      </div>    </div>  </div>  <!-- TRANSACTION RECEIPT MODAL -->  <div id="receiptModal" class="modal">    <div class="modal-content">      <div class="modal-header">        <h2>Transaction Receipt</h2>        <span class="close" onclick="closeModal()">x</span>      </div>      <div class="modal-body receipt-body">        <div class="receipt-header">          <h3>Ally Bank</h3>          <p>Digital Banking Receipt</p>        </div>        <div class="receipt-details">          <p><strong>Reference ID:</strong> <span id="receiptRef"></span></p>          <p><strong>Type:</strong> <span id="receiptType"></span></p>          <p><strong>Amount:</strong> <span id="receiptAmount"></span></p>          <p><strong>Date:</strong> <span id="receiptDate"></span></p>          <p><strong>Description:</strong> <span id="receiptDesc"></span></p>          <p><strong>Account:</strong> <span id="receiptAcc"></span></p>          <p><strong>Status:</strong> <span class="badge success">Completed</span></p>        </div>        <div class="receipt-footer">          <button class="btn-primary" onclick="printReceipt()">Print</button>          <button class="btn-secondary" onclick="closeModal()">Back to Dashboard</button>        </div>      </div>    </div>  </div>  <!-- Footer -->  <footer class="footer">    <div class="container footer-container">      <div class="footer-col">        <div class="footer-logo">          <h3>Ally<span>Bank</span></h3>          <p>Digital banking. No nonsense.</p>        </div>      </div>      <div class="footer-col">        <h4>Products</h4>        <ul>          <li><a href="savings.html">Savings Accounts</a></li>          <li><a href="accounts.html">Checking Accounts</a></li>          <li><a href="investing.html">Certificates of Deposit</a></li>          <li><a href="#">Auto Loans</a></li>        </ul>      </div>      <div class="footer-col">        <h4>Company</h4>        <ul>          <li><a href="#">About Us</a></li>          <li><a href="#">Careers</a></li>          <li><a href="#">Press</a></li>          <li><a href="#">Investor Relations</a></li>        </ul>      </div>      <div class="footer-col">        <h4>Contact</h4>        <p>Email: <a href="mailto:allybank452@gmail.com">allybank452@gmail.com</a></p>        <div class="social-links"></div>      </div>    </div>    <div class="footer-bottom">      <div class="container">        <p>&copy; 2025 Ally Bank. Member FDIC. Equal Housing Lender.</p>        <div class="legal-links">          <a href="privacy.html">Privacy Policy</a>          <a href="terms.html">Terms of Use</a>          <a href="security.html">Security</a>        </div>      </div>    </div>  </footer>  <!-- Firebase SDK -->  <script type="module">    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";    import { getAuth, onAuthStateChanged, signOut, updateEmail } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";    import { getFirestore, doc, getDoc, updateDoc, collection, getDocs, addDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";    // Firebase configuration    const firebaseConfig = {      apiKey: "AIzaSyA5r_nrSgK7lEZdG52tqLZZBh5fnQHz9ew",      authDomain: "allybank-478ad.firebaseapp.com",      projectId: "allybank-478ad",      storageBucket: "allybank-478ad.firebasestorage.app",      messagingSenderId: "805352082325",      appId: "1:805352082325:web:90cf70bcfd1a057f4f449c",      measurementId: "G-GPRQK6L99L"    };    // Initialize Firebase    const app = initializeApp(firebaseConfig);    const auth = getAuth(app);    const db = getFirestore(app);    // Global data    let CURRENT_USER = null;    let SELECTED_TX = null;    let USERS = [];    let transferData = null;    // Generate unique reference ID    function generateRefId() {      return 'TX' + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substr(2, 3).toUpperCase();    }    // Toggle profile visibility    function toggleProfile() {      const profileCard = document.querySelector('.profile-card');      const btn = document.querySelector('.show-profile-btn');      if (profileCard.classList.contains('visible')) {        profileCard.classList.remove('visible');        btn.textContent = 'Show Profile';      } else {        profileCard.classList.add('visible');        btn.textContent = 'Hide Profile';      }    }    // Load user data    document.addEventListener('DOMContentLoaded', async () => {      const navLinks = document.getElementById('navLinks');      onAuthStateChanged(auth, async (user) => {        if (!user) {          window.location.href = 'login.html';          return;        }        try {          const userDoc = await getDoc(doc(db, 'users', user.uid));          if (!userDoc.exists()) {            signOut(auth);            window.location.href = 'login.html';            return;          }          CURRENT_USER = { id: user.uid, ...userDoc.data() };          // Fetch all users for send money functionality          const usersSnapshot = await getDocs(collection(db, 'users'));          USERS = [];          usersSnapshot.forEach(doc => {            USERS.push({ id: doc.id, ...doc.data() });          });          // Populate dashboard          document.getElementById('userName').textContent = CURRENT_USER.name;          document.getElementById('userAccNum').textContent = CURRENT_USER.accountNumber;          document.getElementById('userBalance').textContent = parseFloat(CURRENT_USER.balance).toFixed(2);          // Profile          document.getElementById('profileName').textContent = CURRENT_USER.name;          document.getElementById('profileEmail').textContent = CURRENT_USER.email;          document.getElementById('profilePhone').textContent = CURRENT_USER.phone || 'Not set';          document.getElementById('profileAddress').textContent = CURRENT_USER.address || 'Not set';          document.getElementById('profileDOB').textContent = CURRENT_USER.dob ? new Date(CURRENT_USER.dob).toLocaleDateString() : 'Not set';          document.getElementById('profileCreated').textContent = CURRENT_USER.createdAt ? new Date(CURRENT_USER.createdAt).toLocaleDateString() : 'Not set';          const initials = CURRENT_USER.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);          document.getElementById('profileInitials').textContent = initials;          const hour = new Date().getHours();          const timeGreeting = hour < 12 ? 'Good morning' : hour < 17 ? 'Good afternoon' : 'Good evening';          const greetingEl = document.getElementById('dynamicGreeting');          const subtitleEl = document.getElementById('greetingSubtitle');          const bannerEl = document.getElementById('firstTimeBanner');          if (!CURRENT_USER.pin) {            greetingEl.innerHTML = `Welcome, <span class="highlight">${CURRENT_USER.name}</span>!`;            subtitleEl.textContent = "Let's secure your account with a PIN.";            bannerEl.style.display = 'block';          } else {            greetingEl.innerHTML = `${timeGreeting}, <span class="highlight">${CURRENT_USER.name}</span>!`;            subtitleEl.textContent = "Your account is secure and ready.";            bannerEl.style.display = 'none';          }          await loadTransactions();        } catch (error) {          console.error('Error loading user data:', error);          alert('Error loading user data: ' + error.message);          signOut(auth);          window.location.href = 'login.html';        }        // Logout button        document.getElementById('logoutBtn').addEventListener('click', async (e) => {          e.preventDefault();          try {            await signOut(auth);            window.location.href = 'login.html';          } catch (error) {            console.error('Logout error:', error);            alert('Failed to log out: ' + error.message);          }        });        // Mobile menu        document.querySelector('.mobile-menu-toggle').addEventListener('click', () => {          navLinks.classList.toggle('active');        });        // Close mobile menu on link click        navLinks.querySelectorAll('a').forEach(link => {          link.addEventListener('click', () => {            navLinks.classList.remove('active');          });        });      });    });    async function loadTransactions() {      const list = document.getElementById('transactionsList');      const transactionsSnapshot = await getDocs(query(collection(db, `users/${CURRENT_USER.id}/transactions`), orderBy('timestamp', 'desc')));      const transactions = [];      transactionsSnapshot.forEach(doc => {        transactions.push({ id: doc.id, ...doc.data() });      });      if (transactions.length > 0) {        list.innerHTML = transactions.slice(0, 5).map(t => `          <div class="transaction-item ${t.type}">            <div class="transaction-info">              <strong>${t.type === 'deposit' ? '+' : '-'}$${t.amount.toFixed(2)}</strong>              <p>${t.desc}</p>            </div>            <small>${new Date(t.date).toLocaleDateString()}</small>            <button class="btn-small" onclick="openReceipt('${t.id}')" style="margin-left: auto;">View Receipt</button>          </div>        `).join('');      } else {        list.innerHTML = '<p class="no-data">No recent transactions.</p>';      }    }    window.openReceipt = async function(txId) {      const txDoc = await getDoc(doc(db, `users/${CURRENT_USER.id}/transactions`, txId));      SELECTED_TX = { id: txId, ...txDoc.data() };      if (!SELECTED_TX.refId) {        SELECTED_TX.refId = generateRefId();        await updateDoc(doc(db, `users/${CURRENT_USER.id}/transactions`, txId), { refId: SELECTED_TX.refId });      }      document.getElementById('receiptRef').textContent = SELECTED_TX.refId;      document.getElementById('receiptType').textContent = SELECTED_TX.type.charAt(0).toUpperCase() + SELECTED_TX.type.slice(1);      document.getElementById('receiptAmount').textContent = (SELECTED_TX.type === 'deposit' ? '+' : '-') + '$' + SELECTED_TX.amount.toFixed(2);      document.getElementById('receiptDate').textContent = new Date(SELECTED_TX.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });      document.getElementById('receiptDesc').textContent = SELECTED_TX.desc;      document.getElementById('receiptAcc').textContent = CURRENT_USER.accountNumber;      openModal('receiptModal');    };    window.printReceipt = function() {      const printContent = document.querySelector('.receipt-body').innerHTML;      const win = window.open('', '', 'width=800,height=600');      win.document.write(`        <html>          <head><title>Receipt - ${SELECTED_TX.refId}</title></head>          <body style="font-family:Arial,sans-serif;padding:2rem;">${printContent}</body>        </html>      `);      win.document.close();      win.print();    };    function openEditProfile() {      document.getElementById('editName').value = CURRENT_USER.name;      document.getElementById('editEmail').value = CURRENT_USER.email;      document.getElementById('editPhone').value = CURRENT_USER.phone || '';      document.getElementById('editAddress').value = CURRENT_USER.address || '';      document.getElementById('editDOB').value = CURRENT_USER.dob || '';      openModal('editProfileModal');    }    document.getElementById('editProfileForm').addEventListener('submit', async (e) => {      e.preventDefault();      const name = document.getElementById('editName').value.trim();      const email = document.getElementById('editEmail').value.trim().toLowerCase();      const phone = document.getElementById('editPhone').value.trim();      const address = document.getElementById('editAddress').value.trim();      const dob = document.getElementById('editDOB').value;      if (!name || !email) {        alert('Name and Email are required');        return;      }      if (USERS.some(u => u.id !== CURRENT_USER.id && u.email === email)) {        alert('Email already taken');        return;      }      try {        await updateEmail(auth.currentUser, email);        await updateDoc(doc(db, 'users', CURRENT_USER.id), { name, email, phone, address, dob });        CURRENT_USER = { ...CURRENT_USER, name, email, phone, address, dob };        closeModal();        location.reload();      } catch (error) {        console.error('Profile update error:', error);        alert('Failed to update profile: ' + error.message);      }    });    function openSetPinModal() {      openModal('setPinModal');    }    document.getElementById('setPinForm').addEventListener('submit', async (e) => {      e.preventDefault();      const newPin = document.getElementById('newPin').value;      const confirmPin = document.getElementById('confirmPin').value;      if (!newPin || !/^\d{4}$/.test(newPin)) {        alert('PIN must be exactly 4 digits');        return;      }      if (newPin !== confirmPin) {        alert('PINs do not match');        return;      }      try {        await updateDoc(doc(db, 'users', CURRENT_USER.id), { pin: newPin });        CURRENT_USER.pin = newPin;        closeModal();        location.reload();      } catch (error) {        console.error('PIN set error:', error);        alert('Failed to set PIN: ' + error.message);      }    });    async function openFullHistory() {      const list = document.getElementById('fullTransactionsList');      const transactionsSnapshot = await getDocs(query(collection(db, `users/${CURRENT_USER.id}/transactions`), orderBy('timestamp', 'desc')));      const transactions = [];      transactionsSnapshot.forEach(doc => {        transactions.push({ id: doc.id, ...doc.data() });      });      if (transactions.length > 0) {        list.innerHTML = transactions.map(t => `          <div class="transaction-item ${t.type}">            <div class="transaction-info">              <strong>${t.type === 'deposit' ? '+' : '-'}$${t.amount.toFixed(2)}</strong>              <p>${t.desc}</p>            </div>            <small>${new Date(t.date).toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' })}</small>            <button class="btn-small" onclick="openReceipt('${t.id}')" style="margin-left: auto;">View Receipt</button>          </div>        `).join('');      } else {        list.innerHTML = '<p class="no-data">No transactions yet.</p>';      }      openModal('fullHistoryModal');    }    function openModal(id) {      document.getElementById(id).classList.add('active');    }    function closeModal() {      document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));    }    document.querySelectorAll('.modal .close').forEach(btn => btn.addEventListener('click', closeModal));    window.addEventListener('click', e => {      if (e.target.classList.contains('modal')) closeModal();    });    function openTransferModal() {      if (!CURRENT_USER.pin) {        alert('Please set your PIN first');        openSetPinModal();        return;      }      openModal('transferModal');    }    function openPayBillModal() {      if (!CURRENT_USER.pin) {        alert('Please set your PIN first');        openSetPinModal();        return;      }      openModal('payBillModal');    }    function openDepositModal() {      if (!CURRENT_USER.pin) {        alert('Please set your PIN first');        openSetPinModal();        return;      }      openModal('depositModal');    }    function openSendMoneyModal() {      if (!CURRENT_USER.pin) {        alert('Please set your PIN first');        openSetPinModal();        return;      }      openModal('sendMoneyModal');    }    document.getElementById('transferForm').addEventListener('submit', async (e) => {      e.preventDefault();      const amount = parseFloat(document.getElementById('transferAmount').value);      const accNum = document.getElementById('transferAccNum').value.trim();      const name = document.getElementById('transferName').value.trim();      const pin = document.getElementById('transferPin').value;      if (!amount || amount <= 0) return alert('Enter a valid amount');      if (amount > 5000) return alert('Max transfer: $5,000');      if (CURRENT_USER.balance < amount) return alert('Insufficient funds');      if (pin !== CURRENT_USER.pin) return alert('Incorrect PIN');      if (!accNum || accNum.length !== 10 || !/^\d{10}$/.test(accNum)) return alert('Invalid account number. Must be exactly 10 digits.');      if (!name) return alert('Enter recipient name');      if (accNum === CURRENT_USER.accountNumber) return alert("You can't transfer to your own account");      transferData = { amount, accNum, name };      document.getElementById('confirmName').textContent = name;      document.getElementById('confirmAcc').textContent = accNum;      document.getElementById('confirmAmount').textContent = amount.toFixed(2);      closeModal();      openModal('confirmModal');    });    document.getElementById('confirmBtn').addEventListener('click', async () => {      if (!transferData) return;      const { amount, accNum, name } = transferData;      const newBalance = CURRENT_USER.balance - amount;      const refId = generateRefId();      try {        await updateDoc(doc(db, 'users', CURRENT_USER.id), { balance: newBalance });        await addDoc(collection(db, `users/${CURRENT_USER.id}/transactions`), {          type: 'withdraw',          amount,          date: new Date().toISOString().split('T')[0],          desc: `To ${name} (${accNum})`,          timestamp: Date.now(),          refId        });        CURRENT_USER.balance = newBalance;        alert(`$${amount.toFixed(2)} sent to ${name} (${accNum})! Ref: ${refId}`);        closeModal();        location.reload();      } catch (error) {        console.error('Transfer error:', error);        alert('Failed to process transfer: ' + error.message);      }    });    document.getElementById('cancelBtn').addEventListener('click', () => {      transferData = null;      closeModal();    });    document.getElementById('payBillForm').addEventListener('submit', async (e) => {      e.preventDefault();      const amount = parseFloat(document.getElementById('billAmount').value);      const payee = document.getElementById('billPayee').value.trim();      const pin = document.getElementById('billPin').value;      if (amount <= 0 || amount > 10000) return alert('Bill amount must be $0.01–$10,000');      if (CURRENT_USER.balance < amount) return alert('Insufficient funds');      if (pin !== CURRENT_USER.pin) return alert('Incorrect PIN');      const newBalance = CURRENT_USER.balance - amount;      const refId = generateRefId();      try {        await updateDoc(doc(db, 'users', CURRENT_USER.id), { balance: newBalance });        await addDoc(collection(db, `users/${CURRENT_USER.id}/transactions`), {          type: 'withdraw',          amount,          date: new Date().toISOString().split('T')[0],          desc: `Bill: ${payee}`,          timestamp: Date.now(),          refId        });        CURRENT_USER.balance = newBalance;        alert(`$${amount.toFixed(2)} paid to ${payee}. Ref: ${refId}`);        closeModal();        location.reload();      } catch (error) {        console.error('Bill payment error:', error);        alert('Failed to process bill payment: ' + error.message);      }    });    document.getElementById('depositForm').addEventListener('submit', async (e) => {      e.preventDefault();      const amount = parseFloat(document.getElementById('depositAmount').value);      const pin = document.getElementById('depositPin').value;      if (amount <= 0 || amount > 5000) return alert('Deposit limit: $5,000');      if (pin !== CURRENT_USER.pin) return alert('Incorrect PIN');      const newBalance = CURRENT_USER.balance + amount;      const refId = generateRefId();      try {        await updateDoc(doc(db, 'users', CURRENT_USER.id), { balance: newBalance });        await addDoc(collection(db, `users/${CURRENT_USER.id}/transactions`), {          type: 'deposit',          amount,          date: new Date().toISOString().split('T')[0],          desc: 'Mobile Deposit',          timestamp: Date.now(),          refId        });        CURRENT_USER.balance = newBalance;        alert(`$${amount.toFixed(2)} deposited! Ref: ${refId}`);        closeModal();        location.reload();      } catch (error) {        console.error('Deposit error:', error);        alert('Failed to process deposit: ' + error.message);      }    });    document.getElementById('sendMoneyForm').addEventListener('submit', async (e) => {      e.preventDefault();      const amount = parseFloat(document.getElementById('sendAmount').value);      const email = document.getElementById('sendEmail').value.trim().toLowerCase();      const pin = document.getElementById('sendPin').value;      if (amount <= 0 || amount > 1000) return alert('Send limit: $1,000');      if (CURRENT_USER.balance < amount) return alert('Insufficient funds');      if (pin !== CURRENT_USER.pin) return alert('Incorrect PIN');      const recipient = USERS.find(u => u.email === email);      if (!recipient) return alert('User not found');      if (recipient.id === CURRENT_USER.id) return alert("You can't send money to yourself");      const senderNewBalance = CURRENT_USER.balance - amount;      const recipientNewBalance = parseFloat(recipient.balance) + amount;      const refId = generateRefId();      try {        await updateDoc(doc(db, 'users', CURRENT_USER.id), { balance: senderNewBalance });        await addDoc(collection(db, `users/${CURRENT_USER.id}/transactions`), {          type: 'withdraw',          amount,          date: new Date().toISOString().split('T')[0],          desc: `Sent to ${recipient.name}`,          timestamp: Date.now(),          refId        });        await updateDoc(doc(db, 'users', recipient.id), { balance: recipientNewBalance });        await addDoc(collection(db, `users/${recipient.id}/transactions`), {          type: 'deposit',          amount,          date: new Date().toISOString().split('T')[0],          desc: `From ${CURRENT_USER.name}`,          timestamp: Date.now(),          refId        });        CURRENT_USER.balance = senderNewBalance;        USERS = USERS.map(u => u.id === recipient.id ? { ...u, balance: recipientNewBalance } : u);        alert(`$${amount.toFixed(2)} sent to ${recipient.name}! Ref: ${refId}`);        closeModal();        location.reload();      } catch (error) {        console.error('Send money error:', error);        alert('Failed to send money: ' + error.message);      }    });  </script></body></html>